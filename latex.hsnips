global
// JavaScript code
// const testDir = require('os').homedir()+'\\OneDrive\\VSCode\\hsnips\\global.js';
// ç”ŸæˆçŸ©é˜µ(è¡Œï¼Œåˆ—ï¼Œå¼€å§‹çš„å ä½ç¬¦ )
function getFunc(){
    const globalDir = import('os').homedir()+'\\OneDrive\\VSCode\\hsnips\\global.js';
    const func = require(globalDir);
    return func;
}
function gen_matrix(nrow, ncol, start_Placeholder=0) {
	let results = "";
	let order = 1+start_Placeholder;
    //è¡Œå¾ªç¯
	for (var i=0; i < nrow; i++){
        //åœ¨æ¯è¡Œçš„å¼€å¤´åŠ ä¸Šä¸€ä¸ªåˆ¶è¡¨ç¬¦
		results += '\t';
        //åˆ—å¾ªç¯
		for(var j = 0; j < ncol - 1; j++){
            //ä¸ºåœ¨å‰n-1ä¸ªè¡Œå…ƒç´ åŠ ä¸Šå¯¹é½â€œ&â€å’Œå ä½ç¬¦$order
			results += "$" + (order).toString() + " & ";
			order ++;
		}
        // åœ¨è¡Œæœ«å°¾åŠ ä¸Šæœ€åä¸€ä¸ªå ä½ç¬¦ä¹‹åæ·»åŠ \\å’Œæ¢è¡Œ
		results += "$" + (order).toString() + " \\\\" + "\\\n";
		order ++;
	}
	return results;
}


//æ£€æŸ¥inputä¸­çš„leftå’Œrightæ˜¯å¦é…å¯¹ã€‚é…å¯¹è¿”å›0ï¼›ä¸é…å¯¹åˆ™è¿”å›ç¬¬ä¸€ä¸ªä¸é…å¯¹çš„leftæˆ–rightçš„ä½ç½®ï¼Œå¹¶ä¸”é€šè¿‡input[i]æ¥ä½¿ç”¨è¯¥ä½ç½®ã€‚
function checkBraces(input, left, right) {
    let stack = [];
    let leftLength = left.length;
    let rightLength = right.length;
    //å°†æ‰€æœ‰çš„leftå’Œrightçš„ä½ç½®pushå…¥æ ˆ
    for (let i = 0; i <= input.length - 1; i++) {
        //å°†left çš„ä½ç½®å…¥æ ˆ
        if (input.substr(i, leftLength) === left) {
            stack.push(i); 
            i += leftLength - 1; //æ£€æŸ¥ä¸‹ä¸€ä¸ªä½ç½®
        }
        //å¦‚æœæœ‰é…å¯¹çš„rightï¼Œåˆ™å°†é…å¯¹çš„leftå‡ºæ ˆï¼›å¦‚æœå‡ºç°äº†æ²¡é…å¯¹çš„rightï¼Œåˆ™è¿”å›å…¶ä½ç½®
        else if (input.substr(i, rightLength) === right) {
            if (stack.length === 0) {
                //å¦‚æœä¹‹åçš„leftå’Œrightéƒ½å®Œæˆé…å¯¹ï¼Œåˆ™æ­¤æ—¶å‡ºç°çš„rightä¸ºä¸é…å¯¹çš„rightï¼Œè¿”å›å…¶ä½ç½®
                return i ; 
            } else {
                stack.pop(); //å¦‚æœå‰é¢æœ‰æ²¡é…å¯¹çš„leftï¼Œåˆ™æ‰¾åˆ°ä¸€ä¸ªé…å¯¹çš„rightï¼Œå°†å‰ä¸€ä¸ªleftçš„ä½ç½®å‡ºæ ˆã€‚
            }
            i += rightLength - 1; //æ£€æŸ¥ä¸‹ä¸€ä¸ªä½ç½®
        }
    }
    if (stack.length > 0) {
        return stack[0]; // åœ¨æ£€æŸ¥å®Œå­—ç¬¦ä¸²åï¼Œå¦‚æœä»æœ‰æ²¡é…å¯¹çš„leftï¼Œåˆ™è¿”å›å…¶ä½ç½®
    }
    return 0; //æ‰€æœ‰çš„leftå’Œrighté…å¯¹åˆ™è¿”å›0
}


//å°†å­—ç¬¦ä¸²æŒ‰ç…§symbolåˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç»™å‡ºæ‰€æœ‰åˆ’åˆ†çš„æ•°ç»„ã€‚
function splitStringBySymbol(input, symbol) {
    let parts = input.split(symbol);
    let result = [];
    //å½“inputä¸å«symbolæ—¶ï¼Œè¿”å›{firstPart: ç©ºå­—ç¬¦ä¸²ï¼ŒsecondPart: input}
    if (parts.length === 1) {
        return [{ firstPart: "", secondPart: input }];
    }
    //å½“inputå«æœ‰symbolæ—¶ï¼Œè¿”å›æ‰€æœ‰è¢«åˆ†å‰²åçš„ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç»„åˆ
    for (let i = 1; i < parts.length; i++) {
        let firstPart = parts.slice(0, i).join(symbol) ;
        if (symbol == "\|") { firstPart += symbol }
        let secondPart = parts.slice(i).join(symbol);
        result.push({ firstPart: firstPart, secondPart: secondPart });
    }
    return result;
}


//è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´æœ‰å‡ ä¸ªç¼©è¿›ï¼Œå‘ä¸‹å–æ•´
function tabCounter(str) {
    let tabCount = 0;
    let spaceCount = 0;
    const spacePerTab = 4;

    for (let char of str) {
        if (char === '\t') {
            tabCount += 1;
        } else if (char === ' ') {
            spaceCount += 1;
            if (spaceCount === spacePerTab) {
                tabCount += 1;
                spaceCount = 0;
            }
        } else { break; }
    }
    return tabCount;
}

// ç§»é™¤å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦
function removeSpace(str){
    return str.replace(/^[\t\x20]+/g,"")
}

// å°†m[i]è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²
function join(m = [""],begin=0,end = m.length){
    let result = ""
    for (let i = begin ; i<=end ;i++){
        result += m[i] ? m[i].replace(/^\n/g,"").replace("\\\\","\\\\\\").replace(/^[\t\x20]+/g,"") : ""
    }
    return result
}

// å°†m[i]ä¸­çš„å­—ç¬¦è½¬ä¹‰: ç”±äºhsnipsè¿”å›çš„ç»“æœ(rv)ä¼šè¢«vscodeè½¬ä¹‰ï¼Œæ‰€ä»¥è¦æŠŠåœ¨m[i]ä¸­å¾—åˆ°çš„å­—ç¬¦ä¸²æ‰‹åŠ¨è½¬ä¹‰ï¼Œæ­¤æ—¶ç”±rvè¿”å›çš„å­—ç¬¦ä¸²æ‰æ˜¯åŸå­—ç¬¦ä¸²ã€‚
function rawStr(str){
    let result = str
    result = result.replace(/\\\\/g,"\\\\\\")
    result = result.replace(/}/g,"\\}")
    return result
}

// ç»™å‡ºinputçš„braketç»“æœã€‚æ­¤å‡½æ•°éœ€è¦åœ¨ketå’Œbraketä¸¤ä¸ªsnippetä¸­ä½¿ç”¨
function replaceBra(input) {
    let lastBraIndex = input.lastIndexOf("\\bra{");
    let maxrun = 10;
    while (lastBraIndex !== -1 && maxrun>0) {
        // æ‰¾åˆ°ä¸\bra{é…å¯¹çš„}
        let closingBraceIndex = checkBraces(input.substring(lastBraIndex+5),"\{","\}")+lastBraIndex+5
        if (closingBraceIndex === -1) {
            return input+"\>"; // å¦‚æœæ²¡æœ‰é…å¯¹çš„}ï¼Œè¿”å›åŸå€¼
        }
        // å°†æœ€åä¸€ä¸ª(beforeBra)\bra{braContent}(afterBra)æ‹†åˆ†
        let beforeBra = input.substring(0, lastBraIndex);
        let braContent = input.substring(lastBraIndex + 5, closingBraceIndex); 
        let afterBra = input.substring(closingBraceIndex + 1);
        // æ£€æŸ¥è¦æ›¿æ¢çš„éƒ¨åˆ†(braContentå’ŒafterBra)é‡Œçš„æ‹¬å·æ˜¯å¦é…å¯¹
        let checkBracesResult1 = checkBraces(braContent, "\{", "\}") + checkBraces(braContent, "\\left","\\right");
        let checkBracesResult2 = checkBraces(afterBra, "\\left", "\\right") + checkBraces(afterBra, "\{","\}");
        if (checkBracesResult1 === 0 && checkBracesResult2 === 0) {
            // å°†\bra{...}...æ‰©å±•æˆ\braket{...|...}
            return beforeBra + "\\braket{" + braContent + "|" + afterBra + "}";
        }
        // ç§»åŠ¨åˆ°å‰ä¸€ä¸ª\bra{
        lastBraIndex = input.lastIndexOf("\\bra{", lastBraIndex - 1);
        maxrun--;
    }
    return input+"\>";
}
endglobal

//####################################
//############### æµ‹è¯• ###############
//####################################
snippet test1 "test1" iA
``
const globalDir = require('os').homedir()+'\\OneDrive\\VSCode\\hsnips\\global.js';
const func = require(globalDir);
rv = func.rawStr("hello!\}\n");
``
endsnippet

snippet test2 "test2" iA
``
rv = getFunc().rawStr("hello!\}\n");
``
endsnippet

//####################################
//############ LaTeX æ¨¡æ¿ ############
//####################################

snippet `use(notebook|math|color|hyperref|homework)` "latex templates" wA
``
const fs = require('fs');
const userHomeDir = require('os').homedir();
const relativePath = '\\OneDrive\\VSCode\\latex-templates\\';
try {
    // åŒæ­¥è¯»å–æ–‡ä»¶å†…å®¹
    let path = userHomeDir+relativePath+m[1]+".latex";
    let data = fs.readFileSync(path);
    // åˆ†å‰²æˆè¡Œ
    const lines = data.toString().split('\n');
    // å¤„ç†æ¯ä¸€è¡Œ
    for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('###')) {
            fileNameToLoad = "\\" + lines[i].substring(3, lines[i].length - 1);
            try{
                let data1 = fs.readFileSync(userHomeDir+relativePath+fileNameToLoad);
                rv += "\n"+data1+"\n";
            }catch(err1){
                rv += lines[i];
            }
        }else{
            rv += lines[i];
        }
    }
} catch (err) {
    console.error('Error reading file:', err);
}
``
endsnippet

//####################################
//############ç®€å•æ•°å­¦ç¬¦å·############
//####################################

snippet `(?<!\\)(\~\=)|(\~\~)|(\+\-)|(\-\+)|(\-\>)|(\-\-\>)|(oo)|(\boc)|(\=\>)|(\=\=)|(!=)|(\<\=)|(\>\=)|(xx)|(?<!\\)(dag)|(?<![oa])(pt)|(\^\^)|(const)|(?<!\\)(star)|(sr)|(?<!inclu)(deg)|(?<!\\)(?<!a)(dd)|(<<)|(>>)|(EE)|(\{\\\,\\leqslant\\\,\} >)|(\/\u0060)|(\\star)|(\|\_)` "ç®€å•æ•°å­¦ç¬¦å·" iAm
``
var mathSymbol=[
    "\{\\,\\simeq\\,\} ",
    "\{\\,\\approx\\,\} ",
    "\{\\,\\pm\\,\} ",
    "\{\\,\\mp\\,\} ",
    "\{\\rightarrow\} ",
    "\{\\longrightarrow\} ",
    "\{\\infty\} ",
    "\{\\,\\propto\\,\} ",
    "\{\\,\\implies\\,\} ",
    "\{\\,\\equiv\\,\} ",
    "\{\\,\\neq\\,\} ",
    "\{\\,\\leqslant\\,\} ",
    "\{\\,\\geqslant\\,\} ",
    "\{\\times\} ",
    "\^\{\\dagger\}",
    "\{\\partial\} ",
    "\{\\wedge\} ",
    "\\text\{Const\.\} ",
    "\^\*",
    "\^2",
    "\^\{\\circ\}",
    "\\\,\\mathbb\{d\}",
    "\{\\,\\ll\\,\} ",
    "\{\\,\\gg\\,\} ",
    "\{\\,\\in\\,\} ",
    "\{\\,\\Leftrightarrow\\,\} ",
    "\{\\,\\sim\\,\} ",
    "\\text\{\\usefont\{OMS\}\{cmsy\}\{m\}\{n\}\$\\star\$\} ",
    "\{\\perp\} "
]
for (let i = 1; i <= mathSymbol.length; i++) {
    if (m[i]){
        rv=mathSymbol[i-1]
    }
}
``
endsnippet

snippet `(?<!\\)(sin|arcsin|cos|arccos|tan|arctan|cot|arccot|csc|arccsc|exp|ln|hbar|det)` "æ•°å­¦å‡½æ•°" iAm
{\\`` rv=m[1] ``}
endsnippet

snippet `\{\\(sin|arcsin|cos|arccos|tan|arctan|cot|arccot|csc|arccsc)\}h` "åŒæ›²ä¸‰è§’å‡½æ•°" iAm
{\\``rv=m[1] ``h}
endsnippet

//####################################
//############å¡«å……æ•°å­¦ç¬¦å·############
//####################################

snippet // "Fraction" iAm
\frac{ ${1:${VISUAL}} }{ $2 } $0
endsnippet

snippet \/ "big /" iAm
{\bigg/}
endsnippet

snippet vec "å‘é‡" im
\symbfit{$1}$0
endsnippet

snippet `([a-zA-Z0-9\{\}\_\^\\\(\)\*\']+)vec` "è‡ªåŠ¨å‘é‡" iAm
\symbfit{`` rv=m[1] ``}$0
endsnippet

snippet til "tilde" im
\tilde{$1}$0
endsnippet

snippet `([a-zA-Z0-9\{\}\_\^\\\(\)\*\']+)mbb` "è‡ªåŠ¨é»‘æ¿ç²—ä½“" iAm
\mathbb{`` rv=m[1] ``}$0
endsnippet

snippet `\{?([a-zA-Z]|\\alpha|\\Alpha|\\beta|\\Beta|\\chi|\\Chi|\\delta|\\Delta|\\varepsilon|\\Varepsilon|\\varphi|\\Phi|\\gamma|\\Gamma|\\eta|\\Eta|\\iota|\\Iota|\\kappa|\\Kappa|\\lambda|\\Lambda|\\mu|\\Mu|\\nu|\\Nu|\\omicron|\\Omicron|\\pi|\\Pi|\\theta|\\Theta|\\rho|\\Rho|\\sigma|\\Sigma|\\tau|\\Tau|\\upsilon|\\Upsilon|\\varsigma|\\Varsigma|\\omega|\\Omega|\\xi|\\Xi|\\psi|\\Psi|\\zeta|\\Zeta)\}?([\_\^]\{?[0-9a-zA-Z]+\}?)?(\.\/2d|\.\/1d|bar|hat|til)` "bar" iAm
\\``
let arr = [
    "\.\/2d",
    "\.\/1d",
    "bar",
    "hat",
    "til"
]
let out_arr = [
    "ddot",
    "dot",
    "overline",
    "hat",
    "tilde"
]
for (let i = 0; i < arr.length; i++) {
    if (m[3] == arr[i]) {
        rv = out_arr[i] 
    } 
}
``{``
rv=m[1]
if (m[2]) {
    rv+=m[2] 
}
``}$0
endsnippet

snippet || "Bigg|" iAm
\bigg|_{$1}^{$2}
endsnippet

snippet `(?<!\\)(sum|prod|int|oint|iint|oiint|iiint)` "A_{$1}^{$2}" iAm
\\``rv=m[1]``_{$1}^{$2} $0
endsnippet

snippet `(?<!\\)lim` "limit" iAm
\lim_{ ${1:n} \to ${2:\infty}} 
endsnippet

snippet `(max|min)` "max / min" iAm
\mathop{\``rv=m[1]``}\limits_{ $1 }$0
endsnippet

snippet `(?<!\\text\{)(span)|(SPAN)` "span" iAm
\text{Span}\left\\{ $1 \right\\} $0
endsnippet

snippet `(over|under)set` "overset & underset" iAm
\\``rv=m[1]``set{ $1 }{ $2 } $0
endsnippet

snippet `(sbk)|(mbk)|(bbk)|(abs)|(?<!big[g]?)(norm)` "\left... $1 \right... $0" iAm
\left``
let arr1 = [
    "\(",
    "\[",
    "\\\{",
    "\|",
    "\\\|"
] 
for (let i = 0; i < arr1.length; i++) {
    if (m[i+1]) {
        rv=arr1[i]
    }
}
`` ${1:${VISUAL}} \right``
let arr2 = [
    "\)",
    "\]",
    "\\\\}",
    "\|",
    "\\\|"
] 
for (let i = 0; i < arr2.length; i++) {
    if (m[i+1]) {
        rv=arr2[i]
    }
}
`` $0
endsnippet

snippet `(?<!\\)(big\])|(?<!\\)(big\))|(big\})|(?<!\\)(bigg\])|(?<!\\)(bigg\))|(?<!\\)(bigg\})|(?<!\\)(big\|)|(?<!\\)(bigg\|)|(?<!\\)(bignorm)|(?<!\\)(biggnorm)` "\big... $1 \big... $0" iAm
\big``
let arr1 = [
    "\[",
    "\(",
    "\\{",
    "g\[",
    "g\(",
    "g\\{",
    "\|",
    "g\|",
    "\\\|",
    "g\\\|"
] 
for (let i = 0; i < arr1.length; i++) {
    if (m[i+1]) {
        rv=arr1[i]
    }
}
`` ${1:${VISUAL}} \big``
let arr2 = [
    "\]",
    "\)",
    "\\\\}",
    "g\]",
    "g\)",
    "g\\\\}",
    "\|",
    "g\|",
    "\\\|",
    "\\\|"
] 
for (let i = 0; i < arr2.length; i++) {
    if (m[i+1]) {
        rv=arr2[i]
    }
}
`` $0
endsnippet

snippet `([a-zA-Z0-9\{\}\_\^\\\(\)\*\']+)/` "è‡ªåŠ¨åˆ†å¼" iAm
\frac{ `` rv=m[1] `` }{ $1 } $0
endsnippet

snippet \,\mathbb{d}d "å¾®åˆ†ç®—å­" iAm
\frac{\,\mathbb{d} $1}{\,\mathbb{d} ${2:t}} $0
endsnippet

snippet pp "åå¾®åˆ†ç®—å­" im
\frac{\partial $1}{\partial ${2:t}} $0
endsnippet

snippet ss "Super Script" iAm
^{$1}$0
endsnippet

snippet sd "subscript" iAm
_{$1}$0
endsnippet

snippet sf "superscript and subscript" iAm
_{ $1 }^{ $2 } $0
endsnippet

snippet tt "text" iAm
\text{$1}$0
endsnippet

snippet opn "operator name" iAm
\operatorname{$1}$0
endsnippet

snippet `(TXT)|(\wtxt)` "text color" iA
{\fontsize{${1:11}}{${2:16}}\color{${3:red}}{${4:txt}}}$0
endsnippet

snippet `BF` "text bf" iA
\textbf{ $1 } $0
endsnippet

snippet `(\S+)spaced` "spaced text" wA
``
for (let char of m[1]){
    rv += (char == m[1][m[1].length-1]) ? char : char + "\\hspace\{\$\{1\:0.25\}em\}"
}
``
endsnippet

snippet sqr "Square Root" iAm
\sqrt{${1:${VISUAL}}}$0
endsnippet

snippet nsq "... Root" im
\sqrt[$1]{${2:${VISUAL}}}$0
endsnippet

snippet `(p|v|b)mat(\d+)\,(\d+)` "matrix" iAm
\\begin{``rv=m[1]``matrix}
``
	rv = gen_matrix(m[2],m[3],0);
``\\end{``rv=m[1]``matrix}$0
endsnippet

snippet `matrix\}\n(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?[\s]+addcol` "matrix add col" iAMm
``
function addcol(str,placeholder) {
    let col = splitStringBySymbol(str,"\\\\")[0].firstPart.replace( /^\s+/g, '')
    col += "& \$"+placeholder + " \\"+"\\"+"\\"
    return col
}
rv = "matrix\}\n"
for (let i = 1; i <= 10; i++) {
    if (m[i]) {
        rv += "\t".repeat(1)+addcol(m[i],i)
        if (m[i+1]) {rv += "\n"}
    }
}
``
endsnippet

snippet `matrix\}\n(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?[\s]+addrow` "matrix add row" iAMm
``
function showMatchGroup(str) {
    let mg = splitStringBySymbol(str,"\\\\")[0].firstPart.replace( /^\s+/g, '')
    return mg
}
function placeholderCounter(str) {
    return splitStringBySymbol(str,"&").length
}
rv = "matrix\}\n"
for (let i = 1; i <= 10; i++) {
    if (m[i]) {
        rv += "\t"+showMatchGroup(m[i])+"\\\\\\\n"
    }
}
rv += "\t$1"
for (let j = 2; j<=placeholderCounter(m[1])+1; j++){
    rv += " & "+"$"+j
}
rv += " \\\\\\"
``
endsnippet

snippet `matrix\}\n(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?(.+\\\n)?[\s]+reinput` "matrix reinput content" iAMm
``
rv = "matrix\}\n"
let counter = 1
for (let i = 1; i <= 10; i++) {
    if (m[i]) {
        m[i] = rawStr(m[i]).replace("\n","")
        console.log("ğŸš€ ~ file: test.js:28 ~ m:", m[i])
        rv += "\t"
        let splited = m[i].replace("\\\\\\","").replace( /^\s+/g, '').split("&")
        if (splited.length == 1) {
            rv += " \$\{"+counter+":"+splited[0]+"\}"
            counter++
        }else{
            for (let j = 0; j < splited.length; j++) {
                rv += " \$\{"+counter+":"+splited[j]+"\} "
                if (j != splited.length-1) {
                    rv +="&"
                }
                counter++
            }
        }
        rv += ( !m[i+1] ? "\\\\\\" : "\\\\\\"+"\n" )
    }else{
        break
    }
}
``
endsnippet

priority 99
snippet `tab(\d+)\,(\d+)` "æ— è¾¹æ¡†è¡¨æ ¼" iA
\begin{array}{*{``rv=m[2]``}{c}}
``
rv=gen_matrix(m[1],m[2]).slice(0,-1) // å»æ‰æœ€åä¸€ä¸ªæ¢è¡Œç¬¦
``
\end{array}
endsnippet

priority 100
snippet `ltab(\d+)\,(\d+)` "ä¸‰çº¿è¡¨" iA
\begin{table}[H]
\centering${1:
\caption{${2:table}\}}
\begin{tabular}{*{``rv=m[2]``}{c}}
\toprule
``rv=gen_matrix(1,m[2],2)``\midrule
``rv=gen_matrix(m[1]-1,m[2],m[2]+2)``\bottomrule
\end{tabular}
\end{table}
endsnippet

snippet `\<(.+)\|` "bra" iAm
\bra{`` rv=m[1] ``}
endsnippet

priority 100
snippet `(?<!\\left)(?<!\\right)(?<!\\bigg)\|(.+)\>` "ket" iAm
``
rv = "\|"+m[1]+"\>"
let splited = splitStringBySymbol(m[1],"\|")
for (let i = splited.length-1; i >=0 ; i--) {
    //æ£€æŸ¥è¯¥æ­¥çš„firstPart[i]æ˜¯å¦ç¬¦åˆæ¡ä»¶:(1)ä¸ä»¥\left|ç»“å°¾(2)ä¸ä»¥\right|ç»“å°¾(3)ä¸ä»¥\bigg|ç»“å°¾ï¼›secondPart[i]æ˜¯å¦ç¬¦åˆæ¡ä»¶:(1)æ‰€æœ‰çš„å¤§æ‹¬å·é…å¯¹ï¼›(2)æ‰€æœ‰çš„\left \righté…å¯¹ã€‚å¦‚æœé…å¯¹åˆ™å°†å…¶ä½œä¸ºketçš„å†…å®¹å¹¶é€€å‡ºå¾ªç¯ã€‚
    let p1 = "\|"+splited[i].firstPart
    let p2 = splited[i].secondPart
    if (checkBraces(p2,"\{","\}")==0 && checkBraces(p2,"\\left","\\right")==0 && p1.substring(p1.length-7)!="\\right\|" && p1.substring(p1.length-6)!="\\left\|" && p1.substring(p1.length-6) != "\\bigg\|") {
        rv=p1.substring(0,p1.length-1)+"\\ket\{"+p2+"\}"
        break
    }
}
// ketä¼˜å…ˆçº§é«˜äºbraketï¼Œæœ‰å¯èƒ½å‡ºç° \braket{a|b}... bra{a}b>æ— æ³•è¢«braketå¤„ç†çš„æƒ…å†µã€‚
// ä¸ºè¿™ç§æƒ…å†µçš„braketå¤„ç†:
// å¦‚æœm[1]å«æœ‰\bra{...}
if (m[1].includes("\\bra\{")){
    // ç»™å‡º\bra{...}çš„ä½ç½®æŒ‡æ ‡
    let index = m[1].indexOf(/\\bra\{.+\}/g);
    // å°†æŒ‡æ ‡å‰çš„å­—ç¬¦ä¸²æ·»åŠ åˆ°rvä¸­ï¼ŒæŒ‡æ ‡åçš„å­—ç¬¦ä¸²æ·»åŠ åˆ°å¾…å¤„ç†çš„braketä¸­
    rv = "\|"+m[1].substring(0,index);
    braket = m[1].substring(index);
    // å°†braketå¤„ç†åçš„å†…å®¹æ·»åŠ åˆ°rvä¸­
    rv += replaceBra(braket)
}
``
endsnippet

priority 99
snippet `(\\bra\{.+)\>` "dirac braket" iAm
``
rv = replaceBra(m[1])
``
endsnippet

snippet <> "braket" iAm
\braket{ $1 }$0
endsnippet


//####################################
//##############å¸Œè…Šå­—æ¯##############
//####################################

snippet `\.(a)|\.(A)|\.(b)|\.(B)|\.(c)|\.(C)|\.(d)|\.(D)|\.(e)|\.(E)|\.(f)|\.(F)|\.(g)|\.(G)|\.(h)|\.(H)|\.(i)|\.(I)|\.(j)|\.(J)|\.(k)|\.(K)|\.(l)|\.(L)|\.(m)|\.(M)|\.(n)|\.(N)|\.(o)|\.(O)|\.(p)|\.(P)|\.(q)|\.(Q)|\.(r)|\.(R)|\.(s)|\.(S)|\.(t)|\.(T)|\.(u)|\.(U)|\.(v)|\.(V)|\.(w)|\.(W)|\.(x)|\.(X)|\.(y)|\.(Y)|\.(z)|\.(Z)|\.\\(e)|\.\\(E)|\.\\(f)|\.\\(F)` "greek letters" iAm
{\\``
var greekLetters=[ 
    "alpha","Alpha",
    "beta","Beta",
    "chi","Chi",
    "delta","Delta",
    "epsilon","Epsilon",
    "varphi","Phi",
    "gamma","Gamma",
    "eta","Eta",
    "iota","Iota",
    "nabla","square",
    "kappa","Kappa",
    "lambda","Lambda",
    "mu","Mu",
    "nu","Nu",
    "omicron","Omicron",
    "pi","Pi",
    "theta","Theta",
    "rho","Rho",
    "sigma","Sigma",
    "tau","Tau",
    "upsilon","Upsilon",
    "varsigma","Varsigma",
    "omega","Omega",
    "xi","Xi",
    "psi","Psi",
    "zeta","Zeta",
    "varepsilon","Varepsilon",
    "phi","Phi"
]
for (let i = 1; i <= greekLetters.length; i++) {
    if (m[i]){
        rv=greekLetters[i-1]
    }
}
``}
endsnippet

//####################################
//##############ç‰©ç†å­¦å¸¸æ•°#############
//####################################

snippet `\.\/(e0)|\.\/(kb)|\.\/(kk)|\.\/(h)` "ç‰©ç†å­¦å¸¸æ•°" iAm
{``
var consts=["\\epsilon_0","k_\{B\}","\\frac\{1\}\{4\\pi\\epsilon_0\}","\\hbar"]
for (let i = 1; i <= consts.length; i++) {
    if (m[i]){
        rv=consts[i-1]
    }
}
``}
endsnippet

snippet elk "ç”µåŠ¨åŠ›å­¦k" iAm
\frac{${1:1}}{4\pi\epsilon_0 $2}$0
endsnippet

//####################################
//##############è‡ªåŠ¨ä¸‹æ ‡##############
//####################################

snippet `(})(\d)\2` "auto subscript" iAm
`` rv = m[1] + "_" + m[2]``
endsnippet

snippet `\b([A-Za-z])(\d)` "auto subscript" iAm
`` rv = m[1] + "_" + m[2]``
endsnippet

priority 100
snippet `\b([A-Za-z])_(\d{2})` "auto subscript" iAm
`` rv = m[1] + "_{" + m[2] + "}$0" ``
endsnippet

priority 100
snippet `([A-Za-z])S(\d)` "auto subscript" iAm
`` rv = m[1] + "_{" + m[2] + "$1}$2"``
endsnippet

snippet `\{(\\alpha|\\Alpha|\\beta|\\Beta|\\chi|\\Chi|\\delta|\\Delta|\\varepsilon|\\Varepsilon|\\varphi|\\Phi|\\gamma|\\Gamma|\\eta|\\Eta|\\iota|\\Iota|\\kappa|\\Kappa|\\lambda|\\Lambda|\\mu|\\Mu|\\nu|\\Nu|\\omicron|\\Omicron|\\pi|\\Pi|\\theta|\\Theta|\\rho|\\Rho|\\sigma|\\Sigma|\\tau|\\Tau|\\upsilon|\\Upsilon|\\varsigma|\\Varsigma|\\omega|\\Omega|\\xi|\\Xi|\\psi|\\Psi|\\zeta|\\Zeta|\\epsilon|\\Epsilon|\\phi)\}([0-9])` "auto subscript for greek letter" iAm
`` rv = m[1] + "\_" + m[2].substring(0, 1) ``
endsnippet

//###############################################
//################## LaTeXå‘½ä»¤###################
//###############################################

//####################################
//############# LaTeXç¬¦å·#############
//####################################

snippet `(\.\.)|(\{\\cdot\}\.)|(\{\\cdots\}\.)|(\{\\vdots\}\.)|(?<!\\)(\{\\ddots\}\.)` "dots" iA
``
let arr = ["\{\\cdot\}","\{\\cdots\}","\{\\vdots\}","\{\\ddots\}","\{\\cdots\}"]
for (let i = 1; i <= arr.length; i++) {
    if (m[i]) {
        rv = arr[i-1]
    }
}
``
endsnippet

snippet \\ "another line" iA
\\\\ 

endsnippet

snippet `\b(?<!\\)dit` "description item" iA

\item[$1] $0
endsnippet

snippet `IT` "item" iA

\item 
endsnippet


//####################################
//############# LaTeXç¯å¢ƒ#############
//####################################

snippet `(fig)|(FIG)` "Figure environment" iA
\begin{figure}[${1:H}]
	\centering
	\includegraphics[width=0.${2:8}\linewidth]{$3}
\end{figure}
$0
endsnippet

snippet wfig "wrap figure" iA
\begin{wrapfigure}{${1:l}}{${2:0.4}\textwidth}
    \includegraphics[width=${3:0.25}\textheight]{$4}
\end{wrapfigure}

endsnippet

snippet `(figcap)|(FIGC)` "Figure environment" iA
\begin{figure}[${1:H}]
	\centering
	\includegraphics[width=0.${2:8}\linewidth]{$3}
	\caption{$4}
	\label{fig:$5}
\end{figure}
endsnippet

snippet `(bege|enum|ENUM)` "Enumerate" iA
\begin{enumerate}
	\item $0
\end{enumerate}
endsnippet

snippet desc "description" iA
\begin{description}
    \item[$1] $2
\end{description}
endsnippet

snippet `(CEQ)|(eqca)` "cases" iA
\begin{equation}
	\begin{cases}
		${1:${VISUAL}}
	\end{cases}
\end{equation}
$0
endsnippet

snippet `(CA)|(?<![\\\{])(case)|(lrcase)|(LRCA)|(rcase)|(RCA)` "begin cases" iA
``
rv += "\\begin\{"
returnGroup = [
    "",
    "cases",
    "cases",
    "lrcases",
    "lrcases",
    "rcases",
    "rcases"
]
for (let i = 1; i < returnGroup.length; i++) {
    if (m[i]) {
        rv += returnGroup[i] + "\}\n\t\$1\n\\end\{" + returnGroup[i] + "\}"
    }
}
``
endsnippet


snippet `DM` "Display Math Style" iA
\displaystyle 
endsnippet

snippet `(?<!\\[f]?)(eq)?(box)` "box | box in equation" iA
\fbox{``rv = m[1] ? "\$ \\displaystyle" : ""`` $2 ``rv = m[1] ? "\$" : ""``} $0
endsnippet

snippet `(begal|align)` "align" iA
\begin{aligned}
	${0:${VISUAL}}
\end{aligned}
endsnippet

snippet `(begsp)` "split" iA
\begin{split}
	${1:${VISUAL}}
\end{split}
endsnippet

snippet `(\\begin\{equation\})(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?(\n.+)?split` "auto split equation" iAMm
``
lastIndex = 0
lastDefined = 0
// æ‰¾åˆ°æœ€åä¸€ä¸ªæœ‰å®šä¹‰çš„m[]çš„æŒ‡æ ‡
for (let i = 1; i < m.length; i++) {
    if (m[i]) {
        lastDefined += 1
    }
}
// ä»æœ€åä¸€å¯¹é…å¯¹çš„\begin{equation}...\end{equation}å¼€å§‹å¤„ç†
for (let i= lastDefined; i>0; i--){
    if (m[i]) {
        if (m[i].includes("\\begin\{equation\}")){
            lastIndex = i
            break
        }
    }
}
rv = m[1]
// åœ¨lastIndexä¹‹å‰çš„m[i]åŸæ ·è¾“å‡º
for (let i = 2; i<=lastIndex; i++){
    rv += rawStr(m[i])
}
// ä½¿ç”¨stackæ•°ç»„æ¥è®°å½•è¿™ä¸€è¡Œæ˜¯å¦ä»¥\nå¼€å¤´
let stack = new Array(30)
// ä½¿ç”¨n[i]æ¥è®°å½•è¢«å»é™¤\nå’Œç©ºæ ¼çš„m[i]
let n = new Array(30)
// å¾—åˆ°stack[]å’Œn[]
for (let i = 1; i <= 20; i++) {
    if (m[i] && m[i][0]=="\n") {
        stack[i] = 1
    }else{
        stack[i] = 0
    }
    n[i] = m[i] ? m[i].replace(/^\n/g,"").replace(/^[\t\x20]+/g,"").replace("\\\\","\\\\\\") : ""
}
// åœ¨è¿™é‡Œå¼€å§‹split
rv += "\n\t\\begin\{split\}"
// å¤„ç†lastIndexä¹‹åçš„m[i]
for (let i = lastIndex+1; i < 22 ; i++) {
    if (m[i]) {
        let splited = splitStringBySymbol(n[i],"=")
        // åœ¨è¡Œå¼€å¤´åŠ ä¸Šè¢«åˆ é™¤çš„æ¢è¡Œç¬¦ï¼Œå¹¶åŠ ä¸Šç¼©è¿›
        if (stack[i]) {
            rv += "\n\t\t"
        }
        // å¦‚æœn[i]å¯ä»¥è¢«â€œ=â€åˆ’åˆ†ï¼Œå°±å°†â€œ=â€æ›¿æ¢ä¸ºâ€œ=&â€
        if (splited[0].firstPart != "") {
            rv += splited[0].firstPart + " =& "+splited[0].secondPart
        }else{
        // ä¸èƒ½è¢«â€œ=â€åˆ’åˆ†åˆ™åŸæ ·è¾“å‡º
            rv += n[i]
        }
    }else{
        break
    }
}
// splitçš„ç»“å°¾
rv +="\\\\\\\n\t\t\$1 =& \$2\n\t\\end\{split\}"
``
endsnippet

snippet eqsp "equation split" iA
\begin{equation}
	\begin{split}
		${1:${VISUAL}}
	\end{split}
\end{equation}
$0
endsnippet

snippet `(?<!co)(mm)|(MM)` "Inline Math" iA
$ ${1} $ $0
endsnippet

snippet `(EQ|eqt)` "Display Math" iA
\begin{equation}
	${1}
\end{equation}
$0
endsnippet

snippet `(GAT|gather)` "gather" iA
\begin{gather}
    ${1}
\end{gather}
$0
endsnippet

snippet `(?<!\\)label` "æ·»åŠ ç¼–å·" bA
\label{$1}$0
endsnippet

snippet `(?<!\\)capt` "å›¾è¡¨æ ‡é¢˜" iA
\caption{$1}$0
endsnippet

snippet `(?<!\\)eqref` "å¼•ç”¨å…¬å¼" iA
\hyperref[$1]{(\ref{$1})}
endsnippet

snippet `(?<!\\)hfill` "hfill" iA
\hfill 
endsnippet

snippet `(?<!\\)hsp` "hspace,1em" iA
\hspace{${1:1}em}$0
endsnippet

snippet `(?<!\\)vsp` "vspace,1em" iA
\vspace{${1:0.5}em}

$0
endsnippet
`
//####################################
//############# LaTeXæ ‡é¢˜#############
//####################################

snippet `(?<!\\)(\*)?CH` "Chapter" wA
\chapter``if (m[1]){rv=m[1]}``{$1${VISUAL}}
$0
endsnippet

snippet `(?<!\\)\b(\*)?SEC` "Chapter" wA
\section``if (m[1]){rv=m[1]}``{$1${VISUAL}}
$0
endsnippet

snippet `(\*)?(?<!\\)(SUB)` "Subsection" wA
\subsection``if (m[1]){rv=m[1]}``{$1${VISUAL}}
$0
endsnippet

snippet `(?<!\\)(mys|MYS)` "my section" wA
\mysec[$2]{$1}$0
endsnippet

snippet `(ANS|ans)` "answer" iA
\color{myblue}
ç­”ï¼š$0
\color{black}
endsnippet
